<div class="container-fluid">
    <div class="row fade-out-success" ng-hide="successSubscribedMessage==false">
        <div class="col-xs-12">
            <div class="alert alert-dismissible alert-success">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <strong>Well done!</strong> You successfully subscribed to the meal.
            </div>
        </div>
    </div>
    <div class="row fade-out-success" ng-if="userRole=='admin'" ng-hide="pendingRequest==false">
        <div class="col-xs-12">
            <div class="panel panel-info">
                <div class="panel-heading">
                    <h3 class="panel-title">You have a pending request</h3>
                </div>
                <div class="panel-body">
                    <div class="row" ng-repeat="user in meal.privateInfo.users">
                        <div ng-if="user.status == 'pending'" class="my-meal-dtld-list-pending-user">
                            <div class="row" style="margin-right:initial; margin-left:initial; margin-bottom:8px">
                                <div class="col-md-3 col-sm-4 col-xs-12">
                                    <strong>Requested role:</strong> <span ng-if="user.role[0]==cooker">help cooking</span><span ng-if="user.role[0]==cleaner">help cleaning</span><span ng-if="user.role[0]==simpleGuest">simple guest</span>
                                </div>
                                <div class="col-xs-8">
                                    <a class="btn btn-success btn-xs" ng-click="validateSubscription(user._id)">Accept</a>
                                    <a class="btn btn-danger btn-xs" ng-click="refuseSubscription(user._id)">Refuse</a>
                                </div>
                            </div>
                            <div class="row" style="margin:initial">
                                <div class="col-md-3 col-sm-4 col-xs-12" style="float:left">
                                    <img class="img-circle my-meal-dtld-profilePic-pending-validation my-meal-dtld-guestList" ng-src="{{user.picture.data.url}}" alt="User profile picture" />
                                    <span style="float:inherit;margin-top:5px"><span>{{user.first_name}} {{user.last_name}}</span><br/>
                                    <span>{{user.gender}}<span ng-if="user.age"> - {{user.age}} years old</span></span>
                                    </span>
                                </div>
                                <div class="col-md-9 col-sm-8 col-xs-12 text-justify" style="float:left;margin-top:5px">
                                    <div ng-if="user.presentation"><em>"{{user.presentation | limitTo: 150}}{{user.presentation.length > 150 ? '...' : ''}}"</em></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-lg-10 col-md-9 col-sm-8 col-xs-10">
            <div class="col-xs-12">
                <label class="my-meal-dtld-menu-label">{{meal.menu.title}}</label>
            </div>
            <div class="col-xs-12" ng-if="meal.menu.description">
                Description of the meal : {{meal.menu.description}}
            </div>
            <div class="col-xs-12 my-meal-dtld-left">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="my-meal-dtld-label my-meal-dtld-location">{{meal.town}} - {{meal.privateInfo.address}}</div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3">
                        <div class="my-meal-dtld-label my-meal-dtld-date">{{meal.time |date:'EEEE dd MMMM'}} </div>
                    </div>
                    <div class="col-sm-2">
                        <div class="my-meal-dtld-label my-meal-dtld-time" ng-show="(userRole=='cook' || userRole=='admin') && meal.detailedInfo.requiredGuests.cooks.timeCooking">{{meal.detailedInfo.requiredGuests.cooks.timeCooking |date:'HH:mm'}} </div>
                        <div class="my-meal-dtld-label my-meal-dtld-time" ng-hide="(userRole=='cook' || userRole=='admin') && meal.detailedInfo.requiredGuests.cooks.timeCooking">{{meal.time |date:'HH:mm'}} </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <div class="my-meal-dtld-label my-meal-dtld-price-guest" ng-if="userRole=='admin'"><span style="color:black">Total price of the groceries : </span><span style="color:#2fa4e7">{{meal.price | currency}}</span></div>
                    <div class="my-meal-dtld-label" ng-if="userRole=='admin'" style="padding-top: 0px;">Total participants payback : <span style="color:#2fa4e7">{{meal.price - meal.detailedInfo.requiredGuests.hosts.price | currency}}</span></div>
                    <div class="my-meal-dtld-label" ng-if="userRole=='admin'" style="padding-top: 0px;">Price of your meal : <span style="color:#3EA93E">{{meal.detailedInfo.requiredGuests.hosts.price | currency}}</span></div>
                    <div class="my-meal-dtld-label my-meal-dtld-price-guest" ng-if="userRole=='cook'">{{meal.detailedInfo.requiredGuests.cooks.price | currency}} left to pay to {{meal.admin.first_name}} {{meal.admin.last_name}}</div>
                    <div class="my-meal-dtld-label my-meal-dtld-price-guest" ng-if="userRole=='cleaner'">{{meal.detailedInfo.requiredGuests.cleaners.price | currency}} left to pay to {{meal.admin.first_name}} {{meal.admin.last_name}}</div>
                    <div class="my-meal-dtld-label my-meal-dtld-price-guest" ng-if="userRole=='simpleGuest'">{{meal.detailedInfo.requiredGuests.simpleGuests.price | currency}} left to pay to {{meal.admin.first_name}} {{meal.admin.last_name}}</div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <div class="my-meal-dtld-label" ng-if="userRole=='cook'">Inscribed as : <strong>"Help cooking"</strong></div>
                    <div class="my-meal-dtld-label" ng-if="userRole=='cleaner'">Inscribed as : <strong>"Help cleaning"</strong></div>
                    <div class="my-meal-dtld-label" ng-if="userRole=='simpleGuest'">Inscribed as : <strong>"Simple Guest"</strong></div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    Invite friends to participate &nbsp;
                    <div class="fb-send" data-href="{{data_href_publishOnFacebook}}" data-layout="button_count">
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-4 col-xs-2" ng-if="userRole=='admin'">
            <div class="col-sm-6">
                <!--<div class="my-meal-dtld-label my-meal-dtld-edit" ng-click="openModalEdit()">
                    <span class="my-meal-dtld-hidden-txt">Modify</span>
                </div>-->
            </div>
            <div class="col-sm-6">
                <div class="my-meal-dtld-label my-meal-dtld-delete" ng-click="openModalDelete()">
                    <span class="my-meal-dtld-hidden-txt">Delete</span>
                </div>
            </div>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-4 col-xs-2" ng-if="userRole!='admin'">
            <div class="col-sm-offset-4 col-sm-6">
                <div class="my-meal-dtld-label my-meal-dtld-delete" ng-click="openModalUnsubscribe()">
                    <span class="my-meal-dtld-hidden-txt">Unsubscribe</span>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-9 page-header">
            Participants
        </div>

        <div class="col-xs-3 my-meal-dtld-right">
            <div ng-style="getStyle()" class="" style="font-size: 12px; width: 100%;top:39%;position:absolute;color: rgba(56, 52, 52, 0.45);font-weight:bold; text-align:center; padding:inherit">{{meal.nbGuests-meal.nbRemainingPlaces}} / {{meal.nbGuests}}</div>
            <div ng-style="getStyle()" style="width:67px;margin:auto">
                <div round-progress responsive="true" max="meal.nbGuests" current="meal.nbGuests - meal.nbRemainingPlaces" color="#45ccce" bgcolor="#eaeaea" radius="30" stroke="10" rounded="true" duration="800" animation="easeInOutQuart" animation-delay="0"> </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="panel panel-default my-meal-dtld-panel" ng-class="{'my-meal-dtld-panel-success': userRole=='admin', 'my-meal-dtld-panel-info': userRole!='admin'}">
            <div class="panel-body">
                <div class="col-xs-12">
                    <div class="row">
                        <div class="text-primary my-meal-dtld-title">Your host :<span class="my-meal-dtld-price" style="font-size:14px" ng-if="userRole=='admin'">{{meal.detailedInfo.requiredGuests.hosts.price | currency}}</span></div>
                    </div>
                    <div class="row" ng-repeat="user in meal.privateInfo.users">
                        <div ng-if="user.role[0] == 'admin'"><a href="{{user.link}}"><img class="img-circle my-meal-dtld-profilePic" ng-src="{{user.picture.data.url}}" alt="User profile picture" /><span class="my-meal-dtld-guestList">{{user.first_name}} {{user.last_name}}</a><span ng-if="user.privateInfo.cellphone"> - {{user.privateInfo.cellphone}}</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row" ng-if="meal.detailedInfo.requiredGuests.cooks">
        <div class="panel panel-default my-meal-dtld-panel" ng-class="{'my-meal-dtld-panel-success': userRole=='cook'}">
            <div class="panel-body">
                <div class="col-xs-8">
                    <div class="row">
                        <div class="text-primary my-meal-dtld-title">Help cooking</div>
                    </div>
                    <div class="row" ng-if="userRole == 'admin'">
                        <div class="my-meal-dtld-price">{{meal.detailedInfo.requiredGuests.cooks.price | currency}} per pers</div>
                    </div>
                    <div class="row" ng-repeat="user in meal.privateInfo.users">
                        <div ng-if="user.role[0] == 'cook' && user.status == 'accepted'"><a href="{{user.link}}"><img class="img-circle my-meal-dtld-profilePic" ng-src="{{user.picture.data.url}}" alt="User profile picture" /><span class="my-meal-dtld-guestList">{{user.first_name}} {{user.last_name}}</a><span ng-if="user.privateInfo.cellphone"> - {{user.privateInfo.cellphone}}</span></span>
                        </div>
                        <div ng-if="user.role[0] == 'cook' && user.status == 'pending'"><img class="img-circle my-meal-dtld-profilePic" ng-src="../static/sources/viewMyMealDtld/unknown_user.png" /><span class="text-muted my-meal-dtld-guestList">Pending request</span></div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class="row">
                        <div class="my-meal-dtld-label my-meal-dtld-time">{{meal.detailedInfo.requiredGuests.cooks.timeCooking |date:'HH:mm'}} </div>
                    </div>
                    <div class="row">
                        Remaining places : {{meal.detailedInfo.requiredGuests.cooks.nbRemainingPlaces}}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row" ng-if="meal.detailedInfo.requiredGuests.cleaners">
        <div class="panel panel-default my-meal-dtld-panel" ng-class="{'my-meal-dtld-panel-success': userRole=='cleaner'}">
            <div class="panel-body">
                <div class="col-xs-8">
                    <div class="row">
                        <div class="text-primary my-meal-dtld-title">Help cleaning</div>
                    </div>
                    <div class="row" ng-if="userRole == 'admin'">
                        <div class="my-meal-dtld-price">{{meal.detailedInfo.requiredGuests.cleaners.price | currency}} per pers</div>
                    </div>
                    <div class="row" ng-repeat="user in meal.privateInfo.users">
                        <div ng-if="user.role[0] == 'cleaner' && user.status == 'accepted'"><a href="{{user.link}}"><img class="img-circle my-meal-dtld-profilePic" ng-src="{{user.picture.data.url}}" alt="User profile picture" /><span class="my-meal-dtld-guestList">{{user.first_name}} {{user.last_name}}</a><span ng-if="user.privateInfo.cellphone"> - {{user.privateInfo.cellphone}}</span></span>
                        </div>
                        <div ng-if="user.role[0] == 'cleaner' && user.status == 'pending'"><img class="img-circle my-meal-dtld-profilePic" ng-src="../static/sources/viewMyMealDtld/unknown_user.png" /><span class="text-muted my-meal-dtld-guestList">Pending request</span></div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class="row">
                        <div class="my-meal-dtld-label my-meal-dtld-time">{{meal.time |date:'HH:mm'}} </div>
                    </div>
                    <div class="row">
                        Remaining places : {{meal.detailedInfo.requiredGuests.cleaners.nbRemainingPlaces}}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row" ng-if="meal.detailedInfo.requiredGuests.simpleGuests">
        <div class="panel panel-default my-meal-dtld-panel" ng-class="{'my-meal-dtld-panel-success': userRole=='simpleGuest'}">
            <div class="panel-body">
                <div class="col-xs-8">
                    <div class="row">
                        <div class="text-primary my-meal-dtld-title">Simple guest</div>
                    </div>
                    <div class="row" ng-if="userRole == 'admin'">
                        <div class="my-meal-dtld-price">{{meal.detailedInfo.requiredGuests.simpleGuests.price | currency}} per pers</div>
                    </div>
                    <div class="row" ng-repeat="user in meal.privateInfo.users">
                        <div ng-if="user.role[0] == 'simpleGuest' && user.status == 'accepted'"><a href="{{user.link}}"><img class="img-circle my-meal-dtld-profilePic" ng-src="{{user.picture.data.url}}" alt="User profile picture" /><span class="my-meal-dtld-guestList">{{user.first_name}} {{user.last_name}}</a><span ng-if="user.privateInfo.cellphone"> - {{user.privateInfo.cellphone}}</span></span>
                        </div>
                        <div ng-if="user.role[0] == 'simpleGuest' && user.status == 'pending'"><img class="img-circle my-meal-dtld-profilePic" ng-src="../static/sources/viewMyMealDtld/unknown_user.png" /><span class="text-muted my-meal-dtld-guestList">Pending request</span></div>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class="row">
                        <div class="my-meal-dtld-label my-meal-dtld-time">{{meal.time |date:'HH:mm'}} </div>
                    </div>
                    <div class="row">
                        Remaining places : {{meal.detailedInfo.requiredGuests.simpleGuests.nbRemainingPlaces}}
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <div class="fb-comments" data-href="{{data_href_comment}}" data-width="100%" data-numposts="5"></div>
        </div>
    </div>
    <div class="row my-meal-btn-center">
        <a href="/#/my_meals" class="btn btn-primary">Back to my meals</a>
    </div>
</div>